<div class="upgrade-list-container">
  <app-upgrade-page-header></app-upgrade-page-header>
  <main focusOnNavigation aria-label="Upgrade list" id="upgrade-list" class="upgrade-list">
    <mat-stepper orientation="vertical" #stepper [formGroup]="upgradeForm">
      <mat-step [stepControl]="upgradeForm.get('devices')!" errorMessage="Device selection is required.">
        <ng-template matStepLabel>Select Devices</ng-template>
        <mat-form-field>
          <mat-label>Devices</mat-label>
          <mat-select formControlName="devices" multiple>
            @for (device of devices; track device) {
            <mat-option [value]="device.uuid">
              {{ device.hostname }}
            </mat-option>
            }
          </mat-select>
        </mat-form-field>
        <div>
          <button mat-button matStepperNext>Next</button>
        </div>
      </mat-step>
      <mat-step [stepControl]="upgradeForm.get('profile')!" errorMessage="Profile selection is required.">
        <ng-template matStepLabel>Select a Profile</ng-template>
        <mat-form-field>
          <mat-label>Profile</mat-label>
          <mat-select formControlName="profile">
            @for (profile of profiles; track profile) {
            <mat-option [value]="profile.uuid">
              {{ profile.name }}
            </mat-option>
            }
          </mat-select>
        </mat-form-field>
        <div>
          <button mat-button matStepperPrevious>Back</button>
          <button mat-button matStepperNext>Next</button>
        </div>
      </mat-step>
      <mat-step>
        <ng-template matStepLabel>Select Target Version</ng-template>
        <mat-form-field>
          <mat-label>Target Version</mat-label>
          <input matInput formControlName="targetVersion">
        </mat-form-field>
        <div>
          <button mat-button matStepperPrevious>Back</button>
          <button mat-button matStepperNext>Next</button>
        </div>
      </mat-step>
      <mat-step>
        <ng-template matStepLabel>Review and Confirm</ng-template>
        <table>
          <tr>
            <th>Selected Devices</th>
            <td>
              <ul>
                @for (deviceId of upgradeForm.get('devices')?.value; track deviceId) {
                <li>{{ getDeviceHostname(deviceId) }}</li>
                }
              </ul>
            </td>
          </tr>
          <tr>
            <th>Selected Profile</th>
            <td>{{ getProfileName(upgradeForm.get('profile')?.value) }}</td>
          </tr>
          <tr>
            <th>Target Version</th>
            <td>{{ upgradeForm.get('targetVersion')?.value }}</td>
          </tr>
        </table>
        <div>
          <button mat-button matStepperPrevious>Back</button>
          <button mat-raised-button color="primary" (click)="onUpgradeClick()">Upgrade</button>
        </div>
      </mat-step>
    </mat-stepper>
  </main>
  <app-footer></app-footer>
</div>
