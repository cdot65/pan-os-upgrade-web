<!-- upgrade-list.component.html -->
<div class="upgrade-list-container">
    <app-upgrade-page-header></app-upgrade-page-header>
    <main
        focusOnNavigation
        aria-label="Upgrade list"
        id="upgrade-list"
        class="upgrade-list"
    >
        <form [formGroup]="upgradeForm" (ngSubmit)="onUpgradeClick()">
            <div class="upgrade-form-grid">
                <div class="form-field">
                    <mat-form-field class="dropdown">
                        <mat-label>Devices</mat-label>
                        <mat-select formControlName="devices" multiple>
                            @for (device of devices; track device) {
                                <mat-option [value]="device.uuid">
                                    {{ device.hostname }}
                                </mat-option>
                            }
                        </mat-select>
                    </mat-form-field>
                </div>

                <div class="form-field">
                    <mat-form-field class="dropdown">
                        <mat-label>Profile</mat-label>
                        <mat-select formControlName="profile">
                            @for (profile of profiles; track profile) {
                                <mat-option [value]="profile.uuid">
                                    {{ profile.name }}
                                </mat-option>
                            }
                        </mat-select>
                    </mat-form-field>
                </div>

                <div class="form-field">
                    <mat-form-field class="dropdown">
                        <mat-label>Target Version</mat-label>
                        <mat-select formControlName="target_version">
                            @for (version of target_versions; track version) {
                                <mat-option [value]="version">
                                    {{ version }}
                                </mat-option>
                            }
                        </mat-select>
                    </mat-form-field>
                </div>

                <div class="form-field">
                    <mat-label>Dry Run</mat-label>
                    <mat-radio-group formControlName="dry_run">
                        <mat-radio-button [value]="true">True</mat-radio-button>
                        <mat-radio-button [value]="false"
                            >False</mat-radio-button
                        >
                    </mat-radio-group>
                </div>
            </div>
            <h3>Selected Devices</h3>
            <div class="selected-devices">
                @for (
                    deviceId of upgradeForm.get("devices")?.value;
                    track deviceId
                ) {
                    <mat-card class="device-card">
                        <mat-card-header class="table-header">
                            <mat-card-title>{{
                                getDeviceHostname(deviceId)
                            }}</mat-card-title>
                            <mat-card-subtitle
                                >Current Version:
                                {{
                                    getDeviceSwVersion(deviceId)
                                }}</mat-card-subtitle
                            >
                        </mat-card-header>
                        <mat-card-content>
                            <mat-divider></mat-divider>
                            <h4>High Availability</h4>
                            <ul>
                                <li>
                                    Enabled:
                                    {{
                                        getDeviceHaProperties(deviceId)
                                            .ha_enabled
                                    }}
                                </li>
                                <li>
                                    Local State:
                                    {{
                                        getDeviceHaProperties(deviceId)
                                            .local_state
                                    }}
                                </li>
                                <li>
                                    Peer State:
                                    {{
                                        getDeviceHaProperties(deviceId)
                                            .peer_state
                                    }}
                                </li>
                                <li>
                                    Peer IP:
                                    {{
                                        getDeviceHaProperties(deviceId).peer_ip
                                    }}
                                </li>
                            </ul>
                        </mat-card-content>
                    </mat-card>
                }
            </div>
            <div class="button-container">
                <button
                    mat-raised-button
                    color="primary"
                    type="submit"
                    [disabled]="upgradeForm.invalid"
                >
                    Upgrade
                </button>
            </div>
        </form>

        @if (jobIds.length > 0) {
            <div class="upgrade-progress">
                <h3>Upgrade Progress</h3>
                <div class="progress-items">
                    @for (jobId of jobIds; track jobId) {
                        <div class="progress-item">
                            <p>Job ID: {{ jobId }}</p>
                            <mat-progress-bar
                                mode="determinate"
                            ></mat-progress-bar>
                        </div>
                    }
                </div>
            </div>
        }
    </main>

    <app-footer></app-footer>
</div>
